# https://github.com/marketplace/actions/couchdb-in-github-actions
name: TEST CouchDB

on:
  push:
    branches: [api]

jobs:
  build:
    name: Test ${{ matrix.couchdb }}
    runs-on: ubuntu-latest
    strategy:
      matrix:
        couchdb: ["3.1", "3.0", "2.3"]

    steps:
      - name: Git checkout
        uses: actions/checkout@v2

      - name: Start CouchDB
        uses: iamssen/couchdb-github-action@master
        with:
          couchdb-version: ${{ matrix.couchdb }}

      - name: Test endpoint
        run: |
          curl -f http://127.0.0.1:5984/

      - name: Test auth
        run: |
          curl -X POST -H "Content-Type: application/json; charset=utf-8" -d '{"name": "admin", "password": "password"}' http://127.0.0.1:5984/_session
