# idaifieldR [![](reference/figures/idaifieldr_hex_small.png)](https://lsteinmann.github.io/idaifieldR/)

The R-package **idaifieldR** imports data from the [iDAI.field 2 / Field
Desktop database](https://github.com/dainst/idai-field) into R without
the hassle of CSV-exports. This package uses the
[CouchDB-API](https://docs.couchdb.org/en/stable/api/database/index.html)
to connect to your running Field Desktop client and store the entire
database (or just a subset) in a list right in R’s memory. With
idaifieldR, you can update your data on-the-fly and flexibly re-run any
R-script.

In addition to importing data, idaifieldR also offers some formatting to
enhance processing in R. The relevant functions replace UUIDs with the
corresponding identifiers, unnest lists, and reformat the geometry to be
compatible with, e.g., the
[sp](https://cran.r-project.org/web/packages/sp/index.html)-package. For
more information, check out the Demo-Vignette. It’s worth noting that
processing all resources from larger databases can be time-consuming and
memory-intensive, so I recommend only processing the subsets actually
needed for your analyses.

# Key Features

- Import from a running iDAI.field 2 or 3 (Field Desktop) client into R
- Query it, or get the complete project database into R
- Automatically format the data for easier processing
- Get metadata such as creation and modification dates by user
- Just like anything done with R: **easily re-run any analyses when your
  data has changed!**

# Dependencies

idaifieldR needs a syncing [iDAI.field/Field
Desktop-Client](https://github.com/dainst/idai-field) on the same
computer or in the same network to work. Other than that, the package
depends on
[crul](https://cran.r-project.org/web/packages/crul/index.html) and
[jsonlite](https://cran.r-project.org/web/packages/jsonlite/index.html),
both available on CRAN and automatically installed as dependencies.

# Installation

You can install the current version of idaifieldR from GitHub using
`devtools` or `remotes`:

``` r
devtools::install_github("lsteinmann/idaifieldR", build_vignettes = TRUE)
# OR
remotes::install_github("lsteinmann/idaifieldR", build_vignettes = TRUE)
```

# Basic Workflow Example

A demonstration of the package and some of its uses is included in the
paper [“R wie in: Reproduzierbar. Auswertung von Daten aus Field Desktop
mit idaifieldR”](https://doi.org/10.34780/068b-q6c7) published in the
[Forum for Digital Archaeology and
Infrastructure](https://publications.dainst.org/journals/FdAI/index)
(2023, DOI: 10.34780/068b-q6c7) and the corresponding
[supplement](https://repo.dainst.org/dataset/digitales-supplement-zu-r-wie-in-reproduzierbar).
Alternatively, you can check out the
[Demo.Rmd-vignette](https://lsteinmann.github.io/idaifieldR/articles/Demo.html)
(`browseVignettes("idaifieldR")`) or the
[TLDR.Rmd-vignette](https://lsteinmann.github.io/idaifieldR/articles/TLDR.html)
for a shorter overview.

First, we connect to the “rtest” project using
[`connect_idaifield()`](https://lsteinmann.github.io/idaifieldR/reference/connect_idaifield.md)
and retrieve an index of all resources using
[`get_field_index()`](https://lsteinmann.github.io/idaifieldR/reference/get_field_index.md).
Next, we import all resources from the database into a single list of
lists using
[`get_idaifield_docs()`](https://lsteinmann.github.io/idaifieldR/reference/get_idaifield_docs.md).
While this provides metadata about changes and users, it can be slow and
use up a lot of memory. Alternatively, we can query the database
directly using
[`idf_query()`](https://lsteinmann.github.io/idaifieldR/reference/idf_query.md)
to retrieve only the resources we need, such as all resources of the
“pottery” category.

After importing the data, we use
[`simplify_idaifield()`](https://lsteinmann.github.io/idaifieldR/reference/simplify_idaifield.md)
to transform the nested list into a more usable format, replacing
*UUID*s with *identifier*s and converting dating fields to minimum and
maximum values. If a configuration is available, variables from
checkbox-fields are also converted to multiple columns with boolean
values. Lastly, we can use
[`idaifield_as_matrix()`](https://lsteinmann.github.io/idaifieldR/reference/idaifield_as_matrix.md)
to produce a matrix where each row represents a resource and each column
represents a field or a checkbox value. This matrix can be easily
converted into a data.frame for further analysis:

``` r
library(idaifieldR)
# Connect to iDAI.field:
conn <- connect_idaifield(pwd = "hallo", project = "rtest")

# Get an index of the projects database:
index <- get_field_index(conn)

# Get all docs from the projects database:
idaifield_docs <- get_idaifield_docs(conn)

# Get only the docs of category "Pottery" from the database:
pottery <- idf_query(conn, field = "category", value = "Pottery")

# Simplify the nested list: 
pottery <- simplify_idaifield(pottery, uidlist = index)

# Convert it into a matrix:
pottery_mat <- idaifield_as_matrix(pottery)

# Look at the result:
View(pottery_mat)
```

# Contribution

As I constantly use it for my own work, I am improving this package and
trying to stay up-to-date with everything as I go. A special thanks goes
to ChatGPT for helping me a lot with the documentation. Much of the code
is rather old and reflects my learning process much more than good
practice. However, I would be happy about any feedback – be it in the
form of issues or feature requests – and would be even happier if anyone
would like to collaborate on this project. If you are interested in
contributing to idaifieldR, feel free to get in touch with me – or
don’t, and just fork it! ;)

# Package index

## All functions

- [`check_and_unnest()`](https://lsteinmann.github.io/idaifieldR/reference/check_and_unnest.md)
  :

  Check and Unnest an `idaifield_docs`-list

- [`check_idaifieldr_version()`](https://lsteinmann.github.io/idaifieldR/reference/check_idaifieldr_version.md)
  : Check Version of idaifieldR

- [`connect_idaifield()`](https://lsteinmann.github.io/idaifieldR/reference/connect_idaifield.md)
  : Connect to an iDAI.field / Field Desktop Client

- [`convert_to_onehot()`](https://lsteinmann.github.io/idaifieldR/reference/convert_to_onehot.md)
  : Break down a List from a Checkbox Field to Onehot-Coded Values

- [`.onLoad()`](https://lsteinmann.github.io/idaifieldR/reference/dot-onLoad.md)
  : onLoad / onAttach

- [`download_language_list()`](https://lsteinmann.github.io/idaifieldR/reference/download_language_list.md)
  : Download a Language-List from GitHub

- [`find_layer()`](https://lsteinmann.github.io/idaifieldR/reference/find_layer.md)
  : Find the Layer a Resource is Contained in

- [`fix_dating()`](https://lsteinmann.github.io/idaifieldR/reference/fix_dating.md)
  :

  Reduce the Dating-list to *min*/*max*-Values

- [`fix_relations()`](https://lsteinmann.github.io/idaifieldR/reference/fix_relations.md)
  :

  Unnest the Relations in a Resource and Replace the UUIDs with
  *identifiers*

- [`gather_languages()`](https://lsteinmann.github.io/idaifieldR/reference/gather_languages.md)
  : Gather Fields with Multiple Language Values

- [`get_configuration()`](https://lsteinmann.github.io/idaifieldR/reference/get_configuration.md)
  : Get the Custom Project Configuration as Stored in the Project
  Database

- [`get_field_index()`](https://lsteinmann.github.io/idaifieldR/reference/get_field_index.md)
  : Get the Index of an iDAI.field / Field Desktop Database

- [`get_field_inputtypes()`](https://lsteinmann.github.io/idaifieldR/reference/get_field_inputtypes.md)
  :

  Produce a Matrix of Field *inputTypes* from the Custom Project
  Configuration

- [`get_idaifield_docs()`](https://lsteinmann.github.io/idaifieldR/reference/get_idaifield_docs.md)
  :

  Import all *docs* from an iDAI.field / Field Desktop project

- [`get_language_lookup()`](https://lsteinmann.github.io/idaifieldR/reference/get_language_lookup.md)
  : Prepare a Language List as a Lookup Table

- [`get_uid_list()`](https://lsteinmann.github.io/idaifieldR/reference/get_uid_list.md)
  :

  Get the Index of an `idaifield_docs`/`idaifield_resources`-list

- [`idaifield_as_matrix()`](https://lsteinmann.github.io/idaifieldR/reference/idaifield_as_matrix.md)
  :

  Convert an `idaifield_simple`-list to a Matrix

- [`idaifieldr_demodata`](https://lsteinmann.github.io/idaifieldR/reference/idaifieldr_demodata.md)
  : idaifieldR Demodata

- [`idf_get_changes()`](https://lsteinmann.github.io/idaifieldR/reference/idf_get_changes.md)
  : See when and by whom selected resources have been created or
  modified

- [`idf_index_query()`](https://lsteinmann.github.io/idaifieldR/reference/idf_index_query.md)
  :

  Query *docs* from an iDAI.field Database Based on an Index (uidlist)

- [`idf_json_query()`](https://lsteinmann.github.io/idaifieldR/reference/idf_json_query.md)
  :

  Query *docs* from an iDAI.field Database Based on a JSON-Query

- [`idf_last_changed()`](https://lsteinmann.github.io/idaifieldR/reference/idf_last_changed.md)
  : Get a vector of UUIDs or identifiers of the last n changed resources

- [`idf_ping()`](https://lsteinmann.github.io/idaifieldR/reference/idf_ping.md)
  : Ping the Field-Database

- [`idf_projects()`](https://lsteinmann.github.io/idaifieldR/reference/idf_projects.md)
  : Get a Vector of Project Names Present in the Database

- [`idf_query()`](https://lsteinmann.github.io/idaifieldR/reference/idf_query.md)
  :

  Query *docs* from an iDAI.field Database Directly

- [`idf_select_by()`](https://lsteinmann.github.io/idaifieldR/reference/idf_select_by.md)
  :

  Select/Filter an `idaifield_resources`- or `idaifield_docs`-list

- [`idf_sepdim()`](https://lsteinmann.github.io/idaifieldR/reference/idf_sepdim.md)
  : Convert a List of Dimensions to Simpler Values

- [`idf_show_categories()`](https://lsteinmann.github.io/idaifieldR/reference/idf_show_categories.md)
  :

  Show the *categories* Present in an `idaifield_docs`- or
  `idaifield_resources`-list

- [`reformat_geometry()`](https://lsteinmann.github.io/idaifieldR/reference/reformat_geometry.md)
  : Reformat the Geometry of a single iDAI.field / Field Desktop
  resource

- [`remove_config_names()`](https://lsteinmann.github.io/idaifieldR/reference/remove_config_names.md)
  : Remove Everything Before the Colon in a Character Vector

- [`replace_uid()`](https://lsteinmann.github.io/idaifieldR/reference/replace_uid.md)
  :

  Replace a Vector of UUIDs with their *identifier*s

- [`select_by()`](https://lsteinmann.github.io/idaifieldR/reference/select_by.md)
  :

  Deprecated function: Select/filter an `idaifield_resources`- or
  `idaifield_docs`-list

- [`simplify_idaifield()`](https://lsteinmann.github.io/idaifieldR/reference/simplify_idaifield.md)
  :

  Simplify a List Imported from an iDAI.field / Field
  Desktop-`1041-1`\#' Simplify a List Imported from an iDAI.field /
  Field Desktop-Database

# Articles

### All vignettes

- [How to use this package: Detailed
  Workflow](https://lsteinmann.github.io/idaifieldR/articles/Demo.md):
- [TLDR: Essential
  Workflow](https://lsteinmann.github.io/idaifieldR/articles/TLDR.md):
